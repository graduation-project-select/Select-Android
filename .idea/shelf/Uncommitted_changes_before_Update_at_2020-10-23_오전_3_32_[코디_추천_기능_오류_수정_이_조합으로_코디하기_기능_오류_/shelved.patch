Index: app/src/main/java/com/konkuk/select/adpater/CodiBottomRecommendationAdapter.kt
IDEA additional info:
Subsystem: com.intellij.openapi.diff.impl.patch.BaseRevisionTextPatchEP
<+>package com.konkuk.select.adpater\r\n\r\nimport android.view.LayoutInflater\r\nimport android.view.View\r\nimport android.view.ViewGroup\r\nimport android.widget.ImageView\r\nimport android.widget.TextView\r\nimport androidx.recyclerview.widget.RecyclerView\r\nimport com.konkuk.select.R\r\nimport com.konkuk.select.model.Category\r\n\r\nclass CodiBottomRecommendationAdapter(var rcmdList:ArrayList<String>):\r\n    RecyclerView.Adapter<CodiBottomRecommendationAdapter.ItemHolder>() {\r\n\r\n    var itemClickListener:OnItemClickListener?=null\r\n\r\n    interface OnItemClickListener {\r\n        fun OnClickItem(holder: ItemHolder, view: View, data: String, position: Int)\r\n    }\r\n\r\n    inner class ItemHolder(itemView: View) : RecyclerView.ViewHolder(itemView) {\r\n        var tv_category_label: TextView = itemView.findViewById(R.id.tv_category_label)\r\n        var reloadBtn: ImageView = itemView.findViewById(R.id.reloadBtn)\r\n        init {\r\n            reloadBtn.setOnClickListener {\r\n                itemClickListener?.OnClickItem(this, it, rcmdList[adapterPosition], adapterPosition)\r\n            }\r\n        }\r\n    }\r\n\r\n    override fun onCreateViewHolder(parent: ViewGroup, viewType: Int): ItemHolder {\r\n        var v = LayoutInflater.from(parent.context).inflate(R.layout.codi_bottom_recommendation_item, parent, false)\r\n        return ItemHolder(v)\r\n    }\r\n\r\n    override fun onBindViewHolder(holder: ItemHolder, position: Int) {\r\n        holder.tv_category_label.text = rcmdList[position]\r\n    }\r\n\r\n    override fun getItemCount(): Int {\r\n        return rcmdList.size\r\n    }\r\n}
Subsystem: com.intellij.openapi.diff.impl.patch.CharsetEP
<+>UTF-8
===================================================================
--- app/src/main/java/com/konkuk/select/adpater/CodiBottomRecommendationAdapter.kt	(revision a8d1ebe74384d659f4ec052d748556e13ea842e2)
+++ app/src/main/java/com/konkuk/select/adpater/CodiBottomRecommendationAdapter.kt	(date 1603387523389)
@@ -22,7 +22,7 @@
         var tv_category_label: TextView = itemView.findViewById(R.id.tv_category_label)
         var reloadBtn: ImageView = itemView.findViewById(R.id.reloadBtn)
         init {
-            reloadBtn.setOnClickListener {
+            itemView.setOnClickListener {
                 itemClickListener?.OnClickItem(this, it, rcmdList[adapterPosition], adapterPosition)
             }
         }
Index: app/src/main/java/com/konkuk/select/activity/AddCodiActivity.kt
IDEA additional info:
Subsystem: com.intellij.openapi.diff.impl.patch.BaseRevisionTextPatchEP
<+>package com.konkuk.select.activity\r\n\r\nimport android.annotation.SuppressLint\r\nimport android.content.Intent\r\nimport android.graphics.Bitmap\r\nimport android.graphics.Canvas\r\nimport android.graphics.Color\r\nimport android.graphics.drawable.Drawable\r\nimport android.os.Bundle\r\nimport android.util.Log\r\nimport android.view.MotionEvent\r\nimport android.view.View\r\nimport android.view.ViewGroup\r\nimport android.widget.ImageView\r\nimport android.widget.Toast\r\nimport androidx.appcompat.app.AppCompatActivity\r\nimport androidx.constraintlayout.widget.ConstraintLayout\r\nimport androidx.lifecycle.MutableLiveData\r\nimport androidx.lifecycle.Observer\r\nimport androidx.recyclerview.widget.LinearLayoutManager\r\nimport com.bumptech.glide.Glide\r\nimport com.konkuk.select.R\r\nimport com.konkuk.select.adpater.CodiBottomCategoryAdapter\r\nimport com.konkuk.select.adpater.CodiBottomClothesLinearAdapter\r\nimport com.konkuk.select.adpater.CodiBottomRecommendationAdapter\r\nimport com.konkuk.select.model.Clothes\r\nimport com.konkuk.select.network.Fbase\r\nimport com.konkuk.select.utils.StaticValues\r\nimport kotlinx.android.synthetic.main.activity_add_codi.*\r\nimport kotlinx.android.synthetic.main.toolbar.view.*\r\nimport kotlinx.android.synthetic.main.toolbar_codi_bottom.view.*\r\nimport org.json.JSONObject\r\nimport java.io.ByteArrayOutputStream\r\nimport java.util.Random\r\nimport kotlin.collections.ArrayList\r\n\r\n\r\nclass AddCodiActivity : AppCompatActivity() {\r\n    var categoryList: ArrayList<String> = StaticValues.categoryList\r\n\r\n    lateinit var codiBottomCategoryAdapter: CodiBottomCategoryAdapter   // 카테고리 목록\r\n    lateinit var codiBottomClothesLinearAdapter: CodiBottomClothesLinearAdapter // 옷 목록\r\n    lateinit var codiBottomRecommendationAdapter: CodiBottomRecommendationAdapter //추천 목록\r\n    var codiBottomClothesList: ArrayList<Clothes> = arrayListOf()\r\n\r\n    var codiClothesList: ArrayList<Clothes> = arrayListOf()  // 코디에 사용된 옷들\r\n\r\n    val myClothes: ArrayList<Clothes> = arrayListOf() // 내 옷들\r\n    lateinit var inputClothes: Clothes // 코디 추천에 input으로 준 옷\r\n    var recommendItemsList: ArrayList<ArrayList<Clothes>> = arrayListOf() // 추천된 코디들\r\n    var recommendItems: ArrayList<Clothes> = arrayListOf() // 코디 추천 옷들\r\n    var codiClothesID: MutableSet<String> = mutableSetOf() // input으로 준 옷과 유사한 코디들 ID\r\n    var hBool: MutableSet<String> = mutableSetOf()\r\n    var sBool: MutableSet<String> = mutableSetOf()\r\n    var vBool: MutableSet<String> = mutableSetOf()\r\n\r\n    var isClothesLoading: MutableLiveData<Boolean> = MutableLiveData(false)\r\n    var isHLoading: MutableLiveData<Boolean> = MutableLiveData(false)\r\n    var isSLoading: MutableLiveData<Boolean> = MutableLiveData(false)\r\n    var isVLoading: MutableLiveData<Boolean> = MutableLiveData(false)\r\n    var isAllLoading: MutableLiveData<Boolean> = MutableLiveData(false)\r\n    var isCodiRecmLodaing: MutableLiveData<Boolean> = MutableLiveData(false)\r\n\r\n    var oldXvalue: Float = 0.0f\r\n    var oldYvalue: Float = 0.0f\r\n\r\n    var isSharing:Boolean = false\r\n    var closetId:String = \"\"\r\n    var ownerUid:String = \"\"\r\n    var senderUid:String = \"\"\r\n\r\n    override fun onCreate(savedInstanceState: Bundle?) {\r\n        super.onCreate(savedInstanceState)\r\n        setContentView(R.layout.activity_add_codi)\r\n        checkSharing()\r\n        settingToolBar()\r\n        settingAdapter()\r\n        setClickListener()\r\n        setObserver()\r\n    }\r\n\r\n    private fun checkSharing(){\r\n        if(intent.hasExtra(\"isSharing\")){\r\n            isSharing = intent.getBooleanExtra(\"isSharing\", false)\r\n            intent.getStringExtra(\"closetId\")?.let {\r\n                closetId = it\r\n            }\r\n            intent.getStringExtra(\"ownerUid\")?.let{\r\n                ownerUid = it\r\n            }\r\n            intent.getStringExtra(\"senderUid\")?.let{\r\n                senderUid = it\r\n            }\r\n        }\r\n        if(isSharing){\r\n            toolbar_codi_bottom.randomCodiBtn.visibility = View.GONE\r\n        }\r\n    }\r\n\r\n    private fun settingToolBar() {\r\n        toolbar.title_tv.text = getString(R.string.activity_title_addCodi)\r\n        toolbar.left_iv.setImageResource(R.drawable.back)\r\n        toolbar.right_iv.visibility = View.GONE\r\n        toolbar.right_tv.visibility = View.VISIBLE\r\n        toolbar.right_tv.text = \"완료\"\r\n\r\n        toolbar.left_iv.setOnClickListener {\r\n            finish()\r\n        }\r\n\r\n        // 완료 버튼\r\n        toolbar.right_tv.setOnClickListener {\r\n            val imgByte = captureScreen(codi_canvas)\r\n            var nextIntent = Intent(this, AddCodiRegisterActivity::class.java)\r\n            nextIntent.putExtra(\"codiClothesList\", codiClothesList)\r\n            nextIntent.putExtra(\"codiImage\", imgByte)\r\n            if(isSharing){\r\n                nextIntent.putExtra(\"isSharing\", true)\r\n                nextIntent.putExtra(\"ownerUid\", ownerUid)\r\n                nextIntent.putExtra(\"senderUid\", senderUid)\r\n            }\r\n            startActivity(nextIntent)\r\n            finish() // TODO 뒤로가기 해야되니깐 finish 하면 안되는데 일단..!\r\n        }\r\n    }\r\n\r\n    private fun settingAdapter() {\r\n        codiBottomCategoryAdapter = CodiBottomCategoryAdapter(categoryList)\r\n        codiBottomClothesLinearAdapter = CodiBottomClothesLinearAdapter(codiBottomClothesList)\r\n        codiBottomRecommendationAdapter = CodiBottomRecommendationAdapter(categoryList)\r\n        bottom_rv.adapter = codiBottomCategoryAdapter\r\n        switchLayoutManager()\r\n    }\r\n\r\n    private fun switchLayoutManager() {\r\n        bottom_rv.layoutManager = when (bottom_rv.adapter) {\r\n            codiBottomCategoryAdapter -> {\r\n                LinearLayoutManager(this, LinearLayoutManager.VERTICAL, false)\r\n            }\r\n            codiBottomClothesLinearAdapter -> {\r\n                LinearLayoutManager(this, LinearLayoutManager.HORIZONTAL, false)\r\n            }\r\n            codiBottomRecommendationAdapter -> {\r\n                LinearLayoutManager(this, LinearLayoutManager.HORIZONTAL, false)\r\n            }\r\n            else -> {\r\n                LinearLayoutManager(this, LinearLayoutManager.VERTICAL, false)\r\n            }\r\n        }\r\n    }\r\n\r\n    private fun initClothesList(category: String, uid:String, closetId:String = \"\") {\r\n        var clothesRef = Fbase.CLOTHES_REF\r\n            .whereEqualTo(\"category\", category)\r\n            .whereEqualTo(\"uid\", uid)\r\n        if(closetId != \"\") clothesRef = clothesRef.whereArrayContains(\"closet\", closetId)\r\n        clothesRef.get()\r\n            .addOnSuccessListener { documents ->\r\n                codiBottomClothesList.clear()\r\n                for (document in documents) {\r\n                    val clothesObj = Fbase.getClothes(document)\r\n                    codiBottomClothesList.add(clothesObj)\r\n                }\r\n                codiBottomClothesLinearAdapter.notifyDataSetChanged()\r\n            }\r\n            .addOnFailureListener { exception ->\r\n                Log.w(\"firebase\", \"Error getting documents: \", exception)\r\n            }\r\n    }\r\n\r\n    private fun setClickListener() {\r\n        codiBottomCategoryAdapter.itemClickListener =\r\n            object : CodiBottomCategoryAdapter.OnItemClickListener {\r\n                override fun OnClickItem(\r\n                    holder: CodiBottomCategoryAdapter.ItemHolder,\r\n                    view: View,\r\n                    category: String,\r\n                    position: Int\r\n                ) {\r\n                    toolbar_codi_bottom.tv_titile.text = category\r\n                    if(isSharing){\r\n                        initClothesList(category, uid = ownerUid, closetId = closetId)\r\n                    }else{\r\n                        Fbase.uid?.let { initClothesList(category, uid = it) }\r\n                    }\r\n                    bottom_rv.adapter = codiBottomClothesLinearAdapter\r\n                    switchLayoutManager()\r\n                }\r\n            }\r\n\r\n        codiBottomClothesLinearAdapter.itemClickListener =\r\n            object : CodiBottomClothesLinearAdapter.OnItemClickListener {\r\n                override fun OnClickItem(\r\n                    holder: CodiBottomClothesLinearAdapter.ItemHolder,\r\n                    view: View,\r\n                    data: Clothes,\r\n                    position: Int\r\n                ) {\r\n                    if (codiClothesList.contains(data)) {\r\n                        Toast.makeText(this@AddCodiActivity, \"중복 불가\", Toast.LENGTH_SHORT).show()\r\n                    } else {\r\n                        codiClothesList.add(data)\r\n                        var addImgView = ImageView(this@AddCodiActivity)\r\n                        addImgView.layoutParams = ConstraintLayout.LayoutParams(450, 450)\r\n\r\n                        Glide.with(this@AddCodiActivity)\r\n                            .load(data.imgUri)\r\n                            .into(addImgView)\r\n                        codi_canvas.addView(addImgView)\r\n                        dragAndDrop(addImgView)\r\n                    }\r\n                }\r\n\r\n            }\r\n\r\n        toolbar_codi_bottom.randomCodiBtn.setOnClickListener {\r\n            toolbar_codi_bottom.tv_titile.text = \"추천 아이템\"\r\n            Fbase.db.collection(\"clothes\")\r\n                .whereEqualTo(\"uid\", Fbase.auth.uid)\r\n                .get()\r\n                .addOnSuccessListener { documents -> // 내 옷장에 있는 옷들\r\n                    for (document in documents)\r\n                        myClothes.add(Fbase.getClothes(document))\r\n                    isClothesLoading.value = true\r\n                }\r\n\r\n            if (codiClothesList.isEmpty()) inputClothes = myClothes[Random().nextInt(myClothes.size)]\r\n            else inputClothes = codiClothesList[0]\r\n\r\n            getCodiFirebaseDocument(inputClothes)\r\n\r\n            bottom_rv.adapter = codiBottomRecommendationAdapter\r\n            switchLayoutManager()\r\n        }\r\n\r\n        toolbar_codi_bottom.categoryListBtn.setOnClickListener {\r\n            toolbar_codi_bottom.tv_titile.text = \"카테고리\"\r\n            bottom_rv.adapter = codiBottomCategoryAdapter\r\n            switchLayoutManager()\r\n        }\r\n    }\r\n\r\n    private fun setObserver() {\r\n        isHLoading.observe(this, Observer {\r\n            if (isHLoading.value!! && isSLoading.value!! && isVLoading.value!!) isAllLoading.value = true\r\n        })\r\n        isSLoading.observe(this, Observer {\r\n            if (isHLoading.value!! && isSLoading.value!! && isVLoading.value!!) isAllLoading.value = true\r\n        })\r\n        isVLoading.observe(this, Observer {\r\n            if (isHLoading.value!! && isSLoading.value!! && isVLoading.value!!) isAllLoading.value = true\r\n        })\r\n        isAllLoading.observe(this, Observer {\r\n            if (isAllLoading.value!! && isClothesLoading.value!!) {\r\n                for (h in hBool) if (sBool.contains(h) && vBool.contains(h)) codiClothesID.add(h)\r\n                codiRecommend()\r\n            }\r\n        })\r\n        isCodiRecmLodaing.observe(this, Observer {\r\n            if (isCodiRecmLodaing.value!!) {\r\n                Log.d(\"추천된 코디 개수: \", recommendItemsList.size.toString())\r\n            }\r\n        })\r\n    }\r\n\r\n    private fun codiRecommend() {\r\n        /*\r\n        * 0 : 상의\r\n        * 1 : 하의\r\n        * 2 : 드레스\r\n        * 3 : 아우터\r\n        * 4 : 신발\r\n        * 5 : 액세서리\r\n        * */\r\n\r\n        Log.e(\"codiClothesID\", codiClothesID.size.toString())\r\n        for ((index, codiID) in codiClothesID.withIndex()) {\r\n            recommendItems.clear()\r\n            recommendItems.add(inputClothes)\r\n            Log.d(\"현재 검색중인 codiID\", codiID.toString())\r\n            Fbase.db.collection(\"clothes_test\")\r\n                .whereEqualTo(\"codiId\", codiID)\r\n                .get()\r\n                .addOnSuccessListener { documents ->\r\n                    for (document in documents) {\r\n                        val clothesObj = JSONObject(document.data)\r\n                        var color = arrayListOf<Int>(clothesObj.getInt(\"color_h\"), clothesObj.getInt(\"color_s\"), clothesObj.getInt(\"color_v\"))\r\n                        val codiClothes = Clothes(\r\n                            id = \"\",\r\n                            category = clothesObj[\"category\"] as String,\r\n                            subCategory = clothesObj[\"subCategory\"] as String,\r\n                            texture = clothesObj[\"texture\"] as String,\r\n                            color = color,\r\n                            season = arrayListOf<Boolean>(),\r\n                            imgUri = \"\",\r\n                            uid = \"\"\r\n                        )\r\n\r\n                        for (clothes in myClothes) {\r\n                            if (codiClothes.category != inputClothes.category) {\r\n                                if (compareClothes(clothes, codiClothes)) {\r\n                                    recommendItems.add(clothes)\r\n                                }\r\n                            }\r\n                        }\r\n                    }\r\n                    var onepiece = false\r\n                    var twopiece: Array<Boolean> = arrayOf(false, false)\r\n                    for (clothes in recommendItems) {\r\n                        // 상의 하의 또는 드레스는 무조건 있어야함!!\r\n                        if (clothes.category == \"top\") {\r\n                            twopiece[0] = true\r\n                        } else if (clothes.category == \"bottom\") {\r\n                            twopiece[1] = true\r\n                        } else if (clothes.category == \"dress\")\r\n                            onepiece = true\r\n                    }\r\n                    if (onepiece || (twopiece[0] && twopiece[1])) {\r\n                        Log.d(\"추천 코디의 codiID\", codiID.toString())\r\n                        Log.d(\"추천 코디 안의 옷 개수 : \", recommendItems.size.toString())\r\n                        recommendItemsList.add(recommendItems)\r\n                    }\r\n\r\n                    if (index == codiClothesID.size - 1) {\r\n                        isCodiRecmLodaing.value = true\r\n                    }\r\n                }\r\n        }\r\n    }\r\n\r\n    private fun compareClothes(input1: Clothes, input2: Clothes): Boolean {\r\n        if (input1.category == input2.category && input1.subCategory == input2.subCategory && input1.texture == input2.texture) {\r\n            return (input1.color[0] >= (input2.color[0] - 10) && input1.color[0] <= (input2.color[0] + 10)) &&\r\n                    (input1.color[1] >= (input2.color[1] - 10) && input1.color[1] <= (input2.color[1] + 10)) &&\r\n                    (input1.color[2] >= (input2.color[2] - 10) && input1.color[2] <= (input2.color[2] + 10))\r\n        } else return false\r\n    }\r\n\r\n    private fun getCodiFirebaseDocument(inputClothes: Clothes) {\r\n        codiClothesID.clear()\r\n        var allClothes: ArrayList<String> = arrayListOf()\r\n        Fbase.db.collection(\"clothes_test\").get().addOnSuccessListener { documents ->\r\n            for (document in documents)\r\n                allClothes.add(document[\"codiId\"].toString())\r\n        }\r\n\r\n        Fbase.db.collection(\"clothes_test\")\r\n            .whereEqualTo(\"category\", inputClothes.category)\r\n            .whereEqualTo(\"subCategory\", inputClothes.subCategory)\r\n            .whereGreaterThanOrEqualTo(\"color_h\", inputClothes.color[0] - 10)\r\n            .whereLessThanOrEqualTo(\"color_h\", inputClothes.color[0] + 10)\r\n            .get()\r\n            .addOnSuccessListener { documents ->\r\n                hBool.clear()\r\n                for (document in documents)\r\n                    hBool.add(document[\"codiId\"] as String)\r\n                isHLoading.value = true\r\n            }\r\n\r\n        Fbase.db.collection(\"clothes_test\")\r\n            .whereEqualTo(\"category\", inputClothes.category)\r\n            .whereEqualTo(\"subCategory\", inputClothes.subCategory)\r\n            .whereGreaterThanOrEqualTo(\"color_s\", inputClothes.color[1] - 10)\r\n            .whereLessThanOrEqualTo(\"color_s\", inputClothes.color[1] + 10)\r\n            .get()\r\n            .addOnSuccessListener { documents ->\r\n                sBool.clear()\r\n                for (document in documents)\r\n                    sBool.add(document[\"codiId\"] as String)\r\n                isSLoading.value = true\r\n            }\r\n\r\n        Fbase.db.collection(\"clothes_test\")\r\n            .whereEqualTo(\"category\", inputClothes.category)\r\n            .whereEqualTo(\"subCategory\", inputClothes.subCategory)\r\n            .whereGreaterThanOrEqualTo(\"color_v\", inputClothes.color[2] - 10)\r\n            .whereLessThanOrEqualTo(\"color_v\", inputClothes.color[2] + 10)\r\n            .get()\r\n            .addOnSuccessListener { documents ->\r\n                vBool.clear()\r\n                for (document in documents)\r\n                    vBool.add(document[\"codiId\"] as String)\r\n                isVLoading.value = true\r\n            }\r\n    }\r\n\r\n    @SuppressLint(\"ClickableViewAccessibility\")\r\n    private fun dragAndDrop(iv: ImageView) {\r\n        iv.setOnTouchListener(object : View.OnTouchListener {\r\n            override fun onTouch(v: View?, event: MotionEvent?): Boolean {\r\n                val width = (v?.parent as ViewGroup).width - v.width\r\n                val height = (v?.parent as ViewGroup).height - v.height\r\n                if (event?.action == MotionEvent.ACTION_DOWN) {\r\n                    oldXvalue = event.x\r\n                    oldYvalue = event.y\r\n                    //  Log.i(\"Tag1\", \"Action Down X\" + event.getX() + \",\" + event.getY());\r\n                    Log.i(\"Tag1\", \"Action Down rX \" + event.rawX + \",\" + event.rawY)\r\n                } else if (event?.action == MotionEvent.ACTION_MOVE) {\r\n                    v.x = event.rawX - oldXvalue\r\n                    v.y = event.rawY - (oldYvalue + v.height / 2)\r\n                    //  Log.i(\"Tag2\", \"Action Down \" + me.getRawX() + \",\" + me.getRawY());\r\n                } else if (event?.action == MotionEvent.ACTION_UP) {\r\n                    if (v.x > width && v.y > height) {\r\n                        v.x = width.toFloat()\r\n                        v.y = height.toFloat()\r\n                    } else if (v.x < 0 && v.y > height) {\r\n                        v.x = 0f\r\n                        v.y = height.toFloat()\r\n                    } else if (v.x > width && v.y < 0) {\r\n                        v.x = width.toFloat()\r\n                        v.y = 0f\r\n                    } else if (v.x < 0 && v.y < 0) {\r\n                        v.x = 0f\r\n                        v.y = 0f\r\n                    } else if (v.x < 0 || v.x > width) {\r\n                        if (v.x < 0) {\r\n                            v.x = 0f\r\n                            v.y = event.rawY - oldYvalue - v.height\r\n                        } else {\r\n                            v.x = width.toFloat()\r\n                            v.y = event.rawY - oldYvalue - v.height\r\n                        }\r\n                    } else if (v.y < 0 || v.y > height) {\r\n                        if (v.y < 0) {\r\n                            v.x = event.rawX - oldXvalue\r\n                            v.y = 0f\r\n                        } else {\r\n                            v.x = event.rawX - oldXvalue\r\n                            v.y = height.toFloat()\r\n                        }\r\n                    }\r\n                }\r\n                v.bringToFront()\r\n                return true\r\n            }\r\n        })\r\n    }\r\n\r\n    private fun captureScreen(v: View): ByteArray {\r\n        val bm = Bitmap.createBitmap(v.getWidth(), v.getHeight(), Bitmap.Config.ARGB_8888)\r\n        val canvas = Canvas(bm)\r\n        val bgDrawable: Drawable = v.getBackground()\r\n        if (bgDrawable != null) {\r\n            bgDrawable.draw(canvas)\r\n        } else {\r\n            canvas.drawColor(Color.WHITE)\r\n        }\r\n        v.draw(canvas)\r\n        val bytes = ByteArrayOutputStream()\r\n        bm.compress(Bitmap.CompressFormat.JPEG, 100, bytes)\r\n\r\n        return bytes.toByteArray()\r\n    }\r\n\r\n}\r\n\r\n/*\r\n* json 데이터 밀어넣기 -> 이때 기존의 clothes랑 혼합될때 문제 없는지 확인 -> 색인 재설정\r\n* 추천된 코디안에 옷들 가장 많은 것 순으로 추천 -> adapter 이미지 보여주기\r\n* */
Subsystem: com.intellij.openapi.diff.impl.patch.CharsetEP
<+>UTF-8
===================================================================
--- app/src/main/java/com/konkuk/select/activity/AddCodiActivity.kt	(revision a8d1ebe74384d659f4ec052d748556e13ea842e2)
+++ app/src/main/java/com/konkuk/select/activity/AddCodiActivity.kt	(date 1603390460897)
@@ -45,6 +45,8 @@
 
     var codiClothesList: ArrayList<Clothes> = arrayListOf()  // 코디에 사용된 옷들
 
+    lateinit var inputClothes: Clothes // 코디 추천에 input으로 준 옷
+    var combiCodiclothes: ArrayList<Clothes> = arrayListOf() // 이 조합으로 코디하기에서 넘어옷 코디
     val myClothes: ArrayList<Clothes> = arrayListOf() // 내 옷들
     lateinit var inputClothes: Clothes // 코디 추천에 input으로 준 옷
     var recommendItemsList: ArrayList<ArrayList<Clothes>> = arrayListOf() // 추천된 코디들
@@ -72,6 +74,8 @@
     override fun onCreate(savedInstanceState: Bundle?) {
         super.onCreate(savedInstanceState)
         setContentView(R.layout.activity_add_codi)
+        if (intent.hasExtra("combiCodiClothesList"))
+            combiCodiclothes = intent.getSerializableExtra("combiCodiClothesList") as ArrayList<Clothes>
         checkSharing()
         settingToolBar()
         settingAdapter()
@@ -79,8 +83,8 @@
         setObserver()
     }
 
-    private fun checkSharing(){
-        if(intent.hasExtra("isSharing")){
+    private fun checkSharing() {
+        if (intent.hasExtra("isSharing")) {
             isSharing = intent.getBooleanExtra("isSharing", false)
             intent.getStringExtra("closetId")?.let {
                 closetId = it
@@ -127,8 +131,12 @@
     private fun settingAdapter() {
         codiBottomCategoryAdapter = CodiBottomCategoryAdapter(categoryList)
         codiBottomClothesLinearAdapter = CodiBottomClothesLinearAdapter(codiBottomClothesList)
-        codiBottomRecommendationAdapter = CodiBottomRecommendationAdapter(categoryList)
-        bottom_rv.adapter = codiBottomCategoryAdapter
+        if (combiCodiclothes.isEmpty()) {
+            bottom_rv.adapter = codiBottomCategoryAdapter
+        } else {
+            initCodiAdapter(combiCodiclothes)
+            bottom_rv.adapter = codiBottomRecommendationAdapter
+        }
         switchLayoutManager()
     }
 
@@ -139,12 +147,9 @@
             }
             codiBottomClothesLinearAdapter -> {
                 LinearLayoutManager(this, LinearLayoutManager.HORIZONTAL, false)
-            }
-            codiBottomRecommendationAdapter -> {
-                LinearLayoutManager(this, LinearLayoutManager.HORIZONTAL, false)
             }
             else -> {
-                LinearLayoutManager(this, LinearLayoutManager.VERTICAL, false)
+                LinearLayoutManager(this, LinearLayoutManager.HORIZONTAL, false)
             }
         }
     }
@@ -199,36 +204,39 @@
                     if (codiClothesList.contains(data)) {
                         Toast.makeText(this@AddCodiActivity, "중복 불가", Toast.LENGTH_SHORT).show()
                     } else {
-                        codiClothesList.add(data)
-                        var addImgView = ImageView(this@AddCodiActivity)
-                        addImgView.layoutParams = ConstraintLayout.LayoutParams(450, 450)
-
-                        Glide.with(this@AddCodiActivity)
-                            .load(data.imgUri)
-                            .into(addImgView)
-                        codi_canvas.addView(addImgView)
-                        dragAndDrop(addImgView)
-                    }
-                }
-
-            }
-
-        toolbar_codi_bottom.randomCodiBtn.setOnClickListener {
-            toolbar_codi_bottom.tv_titile.text = "추천 아이템"
-            Fbase.db.collection("clothes")
-                .whereEqualTo("uid", Fbase.auth.uid)
-                .get()
-                .addOnSuccessListener { documents -> // 내 옷장에 있는 옷들
-                    for (document in documents)
-                        myClothes.add(Fbase.getClothes(document))
-                    isClothesLoading.value = true
-                }
+                        if (codiClothesList.isEmpty()) {
+                            codiClothesList.add(data)
+                            Fbase.db.collection("clothes")
+                                .whereEqualTo("uid", Fbase.auth.uid)
+                                .get()
+                                .addOnSuccessListener { documents -> // 내 옷장에 있는 옷들
+                                    for (document in documents)
+                                        myClothes.add(Fbase.getClothes(document))
+                                    isClothesLoading.value = true
+                                }
 
-            if (codiClothesList.isEmpty()) inputClothes = myClothes[Random().nextInt(myClothes.size)]
-            else inputClothes = codiClothesList[0]
+                            if (codiClothesList.isEmpty()) inputClothes = myClothes[Random().nextInt(myClothes.size)]
+                            else inputClothes = codiClothesList[0]
 
-            getCodiFirebaseDocument(inputClothes)
+                            getCodiFirebaseDocument(inputClothes)
+                        } else {
+                            codiClothesList.add(data)
+                        }
+
+                        var addImgView = ImageView(this@AddCodiActivity)
+                        addImgView.layoutParams = ConstraintLayout.LayoutParams(450, 450)
 
+                        Glide.with(this@AddCodiActivity)
+                            .load(data.imgUri)
+                            .into(addImgView)
+                        codi_canvas.addView(addImgView)
+                        dragAndDrop(addImgView)
+                    }
+                }
+            }
+
+        toolbar_codi_bottom.randomCodiBtn.setOnClickListener {
+            toolbar_codi_bottom.tv_titile.text = "추천 아이템"
             bottom_rv.adapter = codiBottomRecommendationAdapter
             switchLayoutManager()
         }
@@ -240,6 +248,33 @@
         }
     }
 
+    private fun initCodiAdapter(rcmdList: ArrayList<Clothes>) {
+        codiBottomRecommendationAdapter = CodiBottomRecommendationAdapter(rcmdList)
+        codiBottomRecommendationAdapter.itemClickListener =
+            object : CodiBottomRecommendationAdapter.OnItemClickListener {
+                override fun OnClickItem(
+                    holder: CodiBottomRecommendationAdapter.ItemHolder,
+                    view: View,
+                    data: Clothes,
+                    position: Int
+                ) {
+                    if (codiClothesList.contains(data)) {
+                        Toast.makeText(this@AddCodiActivity, "중복 불가", Toast.LENGTH_SHORT).show()
+                    } else {
+                        codiClothesList.add(data)
+                        var addImgView = ImageView(this@AddCodiActivity)
+                        addImgView.layoutParams = ConstraintLayout.LayoutParams(450, 450)
+
+                        Glide.with(this@AddCodiActivity)
+                            .load(data.imgUri)
+                            .into(addImgView)
+                        codi_canvas.addView(addImgView)
+                        dragAndDrop(addImgView)
+                    }
+                }
+            }
+    }
+
     private fun setObserver() {
         isHLoading.observe(this, Observer {
             if (isHLoading.value!! && isSLoading.value!! && isVLoading.value!!) isAllLoading.value = true
@@ -259,21 +294,14 @@
         isCodiRecmLodaing.observe(this, Observer {
             if (isCodiRecmLodaing.value!!) {
                 Log.d("추천된 코디 개수: ", recommendItemsList.size.toString())
+                recommendItemsList.sortWith(Comparator { vo1, vo2 -> vo1.size - vo2.size })
+                initCodiAdapter(recommendItemsList[0])
             }
         })
     }
 
     private fun codiRecommend() {
-        /*
-        * 0 : 상의
-        * 1 : 하의
-        * 2 : 드레스
-        * 3 : 아우터
-        * 4 : 신발
-        * 5 : 액세서리
-        * */
-
-        Log.e("codiClothesID", codiClothesID.size.toString())
+        Log.e("input과 유사한 코디 수", codiClothesID.size.toString())
         for ((index, codiID) in codiClothesID.withIndex()) {
             recommendItems.clear()
             recommendItems.add(inputClothes)
Index: app/src/main/java/com/konkuk/select/activity/DetailCodiActivity.kt
IDEA additional info:
Subsystem: com.intellij.openapi.diff.impl.patch.BaseRevisionTextPatchEP
<+>package com.konkuk.select.activity\r\n\r\nimport android.content.Intent\r\nimport android.os.Bundle\r\nimport android.view.View\r\nimport androidx.appcompat.app.AppCompatActivity\r\nimport androidx.recyclerview.widget.LinearLayoutManager\r\nimport com.bumptech.glide.Glide\r\nimport com.google.firebase.firestore.DocumentReference\r\nimport com.konkuk.select.R\r\nimport com.konkuk.select.adpater.ClothesItemAdapter\r\nimport com.konkuk.select.model.Clothes\r\nimport com.konkuk.select.model.Codi\r\nimport com.konkuk.select.network.Fbase\r\nimport kotlinx.android.synthetic.main.activity_detail_codi.*\r\nimport kotlinx.android.synthetic.main.toolbar.view.*\r\n\r\nclass DetailCodiActivity : AppCompatActivity() {\r\n\r\n    lateinit var codiId:String\r\n    lateinit var codiObj: Codi\r\n    lateinit var clothesItemAdapter: ClothesItemAdapter\r\n    var codiItemList = ArrayList<Clothes>()\r\n\r\n    override fun onCreate(savedInstanceState: Bundle?) {\r\n        super.onCreate(savedInstanceState)\r\n        setContentView(R.layout.activity_detail_codi)\r\n        setToolBar()\r\n        setAdapter()\r\n        setClickListener()\r\n        getDataFromIntent()\r\n    }\r\n\r\n    fun setToolBar() {\r\n        toolbar.title_tv.text = \"코디 상세보기\"\r\n        toolbar.left_iv.setImageResource(R.drawable.back)\r\n        toolbar.right_iv.setImageResource(R.drawable.x)\r\n        toolbar.left_iv.setOnClickListener { finish() }\r\n        toolbar.right_iv.setOnClickListener {\r\n            val intent = Intent(this, MainActivity::class.java)\r\n            startActivity(intent)\r\n            finishAffinity()\r\n        }\r\n    }\r\n\r\n    fun setAdapter() {\r\n        codiItem_rv.layoutManager = LinearLayoutManager(this, LinearLayoutManager.HORIZONTAL, false)\r\n        clothesItemAdapter = ClothesItemAdapter(this, codiItemList)\r\n        codiItem_rv.adapter = clothesItemAdapter\r\n    }\r\n\r\n    fun setClickListener() {\r\n        clothesItemAdapter.itemClickListener = object : ClothesItemAdapter.OnItemClickListener {\r\n            override fun OnClickItem(\r\n                holder: ClothesItemAdapter.ItemHolder,\r\n                view: View,\r\n                data: Clothes,\r\n                position: Int\r\n            ) {\r\n                val intent = Intent(this@DetailCodiActivity, DetailClothesActivity::class.java)\r\n                intent.putExtra(\"clothesObj\", data)\r\n                startActivity(intent)\r\n            }\r\n        }\r\n    }\r\n\r\n    private fun getDataFromIntent() {\r\n        intent.getStringExtra(\"codiId\")?.let {\r\n            codiId = it\r\n            Fbase.CODI_REF.document(codiId)\r\n                .get().addOnSuccessListener {document ->\r\n                    codiObj  = Fbase.getCodi(document)\r\n                    initView(codiObj.tags, codiObj.imgUri)\r\n                    getClothesListById(codiObj.itemsIds)\r\n                }\r\n        }\r\n    }\r\n\r\n    fun initView(tags:ArrayList<DocumentReference>,imgUri:String){\r\n        var tagString = \"\"\r\n        for(tag in tags){\r\n            tag.get().addOnSuccessListener {\r\n                tagString += it.get(\"name\")\r\n                codiTag.text = tagString\r\n            }\r\n        }\r\n\r\n        Glide.with(this)\r\n            .load(imgUri)\r\n            .into(codiDetailImg)\r\n    }\r\n\r\n    // TODO firebase에서 clothes 객체 배열은 가져올수 없나\r\n    fun getClothesListById(itemsIds:ArrayList<String>){\r\n        for(id in itemsIds){\r\n            codiItemList.clear()\r\n            Fbase.CLOTHES_REF.document(id)\r\n                .get().addOnSuccessListener {\r\n                    val clothesObj = Fbase.getClothes(it)\r\n                     codiItemList.add(clothesObj)\r\n                    clothesItemAdapter.notifyDataSetChanged()\r\n                }\r\n        }\r\n    }\r\n\r\n}
Subsystem: com.intellij.openapi.diff.impl.patch.CharsetEP
<+>UTF-8
===================================================================
--- app/src/main/java/com/konkuk/select/activity/DetailCodiActivity.kt	(revision a8d1ebe74384d659f4ec052d748556e13ea842e2)
+++ app/src/main/java/com/konkuk/select/activity/DetailCodiActivity.kt	(date 1603390027056)
@@ -62,6 +62,11 @@
                 startActivity(intent)
             }
         }
+        CombiDoCodi.setOnClickListener {
+            val intent = Intent(this@DetailCodiActivity, AddCodiActivity::class.java)
+            intent.putExtra("combiCodiClothesList", codiItemList)
+            startActivity(intent)
+        }
     }
 
     private fun getDataFromIntent() {
Index: app/src/main/res/layout/codi_bottom_recommendation_item.xml
IDEA additional info:
Subsystem: com.intellij.openapi.diff.impl.patch.BaseRevisionTextPatchEP
<+><?xml version=\"1.0\" encoding=\"utf-8\"?>\r\n<androidx.constraintlayout.widget.ConstraintLayout\r\n    xmlns:android=\"http://schemas.android.com/apk/res/android\"\r\n    xmlns:app=\"http://schemas.android.com/apk/res-auto\"\r\n    xmlns:tools=\"http://schemas.android.com/tools\"\r\n    android:background=\"@drawable/style_roundbox_black\"\r\n    android:layout_marginHorizontal=\"7dp\"\r\n    android:layout_width=\"wrap_content\"\r\n    android:layout_height=\"match_parent\">\r\n    <androidx.constraintlayout.widget.ConstraintLayout\r\n        android:layout_width=\"0dp\"\r\n        android:layout_height=\"match_parent\"\r\n        app:layout_constraintDimensionRatio=\"h,3:2\"\r\n        app:layout_constraintStart_toStartOf=\"parent\"\r\n        app:layout_constraintEnd_toEndOf=\"parent\"\r\n        app:layout_constraintTop_toTopOf=\"parent\"\r\n        app:layout_constraintBottom_toBottomOf=\"parent\">\r\n\r\n        <ImageView\r\n            android:id=\"@+id/iv_img\"\r\n            android:layout_width=\"match_parent\"\r\n            android:layout_height=\"0dp\"\r\n            android:background=\"@color/colorLightGray\"\r\n            app:layout_constraintBottom_toBottomOf=\"parent\"\r\n            app:layout_constraintDimensionRatio=\"w,1:1\"\r\n            app:layout_constraintEnd_toEndOf=\"parent\"\r\n            app:layout_constraintStart_toStartOf=\"parent\"\r\n            app:layout_constraintTop_toTopOf=\"parent\" />\r\n\r\n        <ImageView\r\n            android:id=\"@+id/reloadBtn\"\r\n            android:layout_width=\"0dp\"\r\n            android:layout_height=\"0dp\"\r\n            android:layout_marginTop=\"8dp\"\r\n            android:layout_marginBottom=\"4dp\"\r\n            android:layout_marginEnd=\"8dp\"\r\n            android:tint=\"@color/colorText\"\r\n            app:layout_constraintBottom_toTopOf=\"@+id/iv_img\"\r\n            app:layout_constraintDimensionRatio=\"w,1:1\"\r\n            app:layout_constraintEnd_toEndOf=\"parent\"\r\n            app:layout_constraintTop_toTopOf=\"parent\"\r\n            app:srcCompat=\"@android:drawable/ic_popup_sync\" />\r\n\r\n        <TextView\r\n            android:id=\"@+id/tv_category_label\"\r\n            android:layout_width=\"wrap_content\"\r\n            android:layout_height=\"wrap_content\"\r\n            android:text=\"상의\"\r\n            android:textColor=\"@color/colorText\"\r\n            app:layout_constraintBottom_toBottomOf=\"parent\"\r\n            app:layout_constraintEnd_toEndOf=\"parent\"\r\n            app:layout_constraintStart_toStartOf=\"parent\"\r\n            app:layout_constraintTop_toBottomOf=\"@+id/iv_img\" />\r\n    </androidx.constraintlayout.widget.ConstraintLayout>\r\n\r\n</androidx.constraintlayout.widget.ConstraintLayout>
Subsystem: com.intellij.openapi.diff.impl.patch.CharsetEP
<+>UTF-8
===================================================================
--- app/src/main/res/layout/codi_bottom_recommendation_item.xml	(revision a8d1ebe74384d659f4ec052d748556e13ea842e2)
+++ app/src/main/res/layout/codi_bottom_recommendation_item.xml	(date 1603387329559)
@@ -20,7 +20,8 @@
             android:id="@+id/iv_img"
             android:layout_width="match_parent"
             android:layout_height="0dp"
-            android:background="@color/colorLightGray"
+            android:background="#eee"
+            android:paddingVertical="5dp"
             app:layout_constraintBottom_toBottomOf="parent"
             app:layout_constraintDimensionRatio="w,1:1"
             app:layout_constraintEnd_toEndOf="parent"
Index: app/src/main/res/layout/activity_add_codi.xml
IDEA additional info:
Subsystem: com.intellij.openapi.diff.impl.patch.BaseRevisionTextPatchEP
<+><?xml version=\"1.0\" encoding=\"utf-8\"?>\r\n<androidx.constraintlayout.widget.ConstraintLayout xmlns:android=\"http://schemas.android.com/apk/res/android\"\r\n    xmlns:app=\"http://schemas.android.com/apk/res-auto\"\r\n    xmlns:tools=\"http://schemas.android.com/tools\"\r\n    android:layout_width=\"match_parent\"\r\n    android:layout_height=\"match_parent\"\r\n    android:background=\"@color/colorBackGround\"\r\n    tools:context=\".activity.AddCodiActivity\">\r\n\r\n    <include\r\n        android:id=\"@+id/toolbar\"\r\n        layout=\"@layout/toolbar\" />\r\n\r\n    <androidx.constraintlayout.widget.ConstraintLayout\r\n        android:layout_width=\"0dp\"\r\n        android:layout_height=\"0dp\"\r\n        app:layout_constraintBottom_toBottomOf=\"parent\"\r\n        app:layout_constraintEnd_toEndOf=\"parent\"\r\n        app:layout_constraintStart_toStartOf=\"parent\"\r\n        app:layout_constraintTop_toBottomOf=\"@id/toolbar\">\r\n\r\n        <androidx.constraintlayout.widget.ConstraintLayout\r\n            android:id=\"@+id/codi_canvas\"\r\n            android:layout_width=\"match_parent\"\r\n            android:layout_height=\"0dp\"\r\n            android:background=\"#eeeeee\"\r\n            app:layout_constraintDimensionRatio=\"w,1:1\"\r\n            app:layout_constraintEnd_toEndOf=\"parent\"\r\n            app:layout_constraintStart_toStartOf=\"parent\"\r\n            app:layout_constraintTop_toTopOf=\"parent\">\r\n\r\n        </androidx.constraintlayout.widget.ConstraintLayout>\r\n\r\n        <androidx.constraintlayout.widget.ConstraintLayout\r\n            android:id=\"@+id/bottom_view\"\r\n            android:layout_width=\"match_parent\"\r\n            android:layout_height=\"0dp\"\r\n            app:layout_constraintBottom_toBottomOf=\"parent\"\r\n            app:layout_constraintEnd_toEndOf=\"parent\"\r\n            app:layout_constraintStart_toStartOf=\"parent\"\r\n            app:layout_constraintTop_toBottomOf=\"@+id/codi_canvas\">\r\n\r\n            <include\r\n                android:id=\"@+id/toolbar_codi_bottom\"\r\n                layout=\"@layout/toolbar_codi_bottom\" />\r\n\r\n            <androidx.recyclerview.widget.RecyclerView\r\n                android:id=\"@+id/bottom_rv\"\r\n                android:layout_width=\"match_parent\"\r\n                android:layout_height=\"0dp\"\r\n                android:paddingVertical=\"12dp\"\r\n                app:layout_constraintBottom_toBottomOf=\"parent\"\r\n                app:layout_constraintEnd_toEndOf=\"parent\"\r\n                app:layout_constraintStart_toStartOf=\"parent\"\r\n                app:layout_constraintTop_toBottomOf=\"@+id/toolbar_codi_bottom\" />\r\n        </androidx.constraintlayout.widget.ConstraintLayout>\r\n\r\n    </androidx.constraintlayout.widget.ConstraintLayout>\r\n\r\n\r\n</androidx.constraintlayout.widget.ConstraintLayout>
Subsystem: com.intellij.openapi.diff.impl.patch.CharsetEP
<+>UTF-8
===================================================================
--- app/src/main/res/layout/activity_add_codi.xml	(revision a8d1ebe74384d659f4ec052d748556e13ea842e2)
+++ app/src/main/res/layout/activity_add_codi.xml	(date 1603384937180)
@@ -23,7 +23,7 @@
             android:id="@+id/codi_canvas"
             android:layout_width="match_parent"
             android:layout_height="0dp"
-            android:background="#eeeeee"
+            android:background="#fff"
             app:layout_constraintDimensionRatio="w,1:1"
             app:layout_constraintEnd_toEndOf="parent"
             app:layout_constraintStart_toStartOf="parent"
